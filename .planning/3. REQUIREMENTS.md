# CCRO Dashboard — Product Requirements Document
*Reverse-engineered from codebase · Version 2.0 · February 2026*
*Updated to reflect current state: 92 routes · 30+ APIs · 50+ DB tables · 26 sprints complete*

---

## 1. Product Overview

The CCRO (Chief Conduct and Risk Officer) Dashboard is a web-based governance platform
for Updraft, a UK FCA-authorised consumer credit lender. It centralises the firm's
risk management, compliance monitoring, Consumer Duty reporting, and regulatory
assurance workflows into a single tool used daily by the risk and compliance function.

**Core purpose:** Give the CCRO, compliance team, and business owners a single system
of record for risk, regulatory, and conduct obligations — replacing spreadsheets,
email threads, and disconnected Word documents.

**Current build state:**
- 92 compiled pages/routes
- 30+ API endpoints
- 50+ PostgreSQL tables
- 264 git commits across 26 completed sprints
- Zero regressions, zero open bugs, zero TypeScript errors

---

## 2. User Roles

| Role | Who | Permissions |
|---|---|---|
| **CCRO Team** | Rob (CCRO), Cath (Compliance) | Full read/write on all modules, admin functions, user management, approve change requests |
| **Owner** | Chris (Operations), Micha (Data & Credit), Ash (Financial Promotions & Growth), Graham (Tech), David (Finance) | Read/write on their assigned risks, controls, actions, and Consumer Duty measures; read-only on other areas; can propose changes; attest controls |
| **Reviewer** | Senior stakeholders, Board | Read-only access to all modules; can submit access requests for elevated permissions |
| **CEO** | Aseem | Special viewer role; approves risk acceptances; changes In Focus items on dashboard; receives board-level reporting |

---

## 3. Module Specifications

### 3.1 Home Dashboard

**Purpose:** At-a-glance portfolio health view, navigating to all major modules.

**Requirements:**
- Customisable dashboard sections per user — add/remove/reorder via drag-and-drop (react-grid-layout)
- Grid layout with configurable column span and row height per section
- Section registry controls visibility by role
- Layout persisted per-user to the database (`DashboardLayout` table)
- Default sections differ by role (CCRO sees all; Owner sees assigned items)
- Dark mode support — all sections adapt automatically

**Current sections (7):**
- `risk-summary` — Portfolio risk stat tiles + 5×5 SVG risk matrix + portfolio trend chart + AnimatedNumber counts
- `action-tracking` — Open/overdue action tiles + priority swimlane pipeline chart + Recharts bar chart
- `consumer-duty` — Rolling ticker cycling Outcomes/Measures/Green/Amber/Red counts + compact outcome grid
- `programme-health` — 4 arc-gauge scorecards (Risk Health, Action Health, Consumer Duty, Compliance)
- `compliance-summary` — Compliance universe status summary
- `horizon-scanning` — Upcoming regulatory change items with In Focus spotlight
- `smcr` — SMCR function occupancy and certification status

**Interactive behaviour:** Every stat tile (bento card) must filter the view below when clicked.

**Animations:** ScrollReveal wrapper fires on both scroll directions; AnimatedNumber count-up on all stat values.

---

### 3.2 Risk Register

**Purpose:** Enterprise risk register with inherent/residual scoring, controls, mitigations, and trend history.

**Risk record contains:**
- Reference (auto-generated, e.g. RR-001)
- Name, description
- Category L1 (5 categories) and L2 (18 sub-categories)
- Owner (linked to a User)
- Inherent likelihood × impact (1–5 each)
- Residual likelihood × impact (1–5 each, after controls applied)
- Control effectiveness: Effective / Partially Effective / Ineffective
- Risk appetite: Very Low / Low / Low-to-Moderate / Moderate
- Direction of travel: Improving / Stable / Deteriorating
- In Focus flag (highlights on risk matrix)
- Review frequency (days), last reviewed date
- Approval status

**Risk-related sub-entities:**
- Inline `RiskControl` records (free-text controls per risk, distinct from Controls Library)
- `RiskMitigation` records (action-linked, with deadline and status)
- `RiskSnapshot` (monthly capture — powers portfolio trend chart)
- `RiskControlLink` (junction to Controls Library)
- `RiskActionLink` (junction to Action Tracking)

**Risk matrix:** 5×5 SVG heatmap with spring-animated dots, ghost dot at inherent position,
click navigates to risk, colour-coded by direction of travel.

**CRUD:** CCRO Team full CRUD. Owners can edit their own, propose changes.
**Import:** CSV upload — creates/updates risks including scores and inline controls.
**Export:** CSV + HTML pack with optional per-risk deep-dive spotlights.

**Risk categories (5 L1, 18 L2):**
- Credit Risk: Loan Performance, Creditworthiness, Concentration, Recovery
- Operational Risk: Fraud, Technology, Process Failure, Third-Party, People
- Conduct Risk: Consumer Outcomes, Financial Promotions, Customer Vulnerability, Complaints
- Regulatory Risk: Regulatory Change, Regulatory Relationship, Sanctions
- Financial Risk: Funding / Liquidity, Market Risk

---

### 3.3 Action Tracking

**Purpose:** Centralised action log across risk register, Consumer Duty MI, controls testing failures, and ad-hoc items.

**Action record contains:**
- Reference (auto-generated, e.g. ACT-001)
- Title, description, issue description
- Status: Open / In Progress / Overdue / Completed
- Priority: P1 (Critical) / P2 (High) / P3 (Medium)
- Assigned to (User)
- Due date
- Source (risk, control, Consumer Duty MI, regulatory change, audit, ad-hoc)
- Linked risk (via `RiskActionLink`)
- Linked control (`controlId` field)
- Linked Consumer Duty MI (`consumerDutyMIId` field)
- Approval status

**Change request workflow:** Owners can propose date extensions or reassignments.
CCRO approves/rejects. Each change logged to accountability timeline.

**Accountability Timeline:** Visual timeline of all changes, approvals, rejections, and progress
updates — with original due date, change count, and delay calculated automatically.

**Dashboard pipeline chart:** 3 swimlane bars (P1/P2/P3) showing OPEN / IN_PROGRESS / OVERDUE
segment widths, clickable to filter.

**CRUD:** CCRO Team full CRUD. Owners can update status and notes on their assigned actions.
**Import:** CSV upload — bulk create actions.
**Export:** CSV + HTML pack with optional action spotlight pages.

---

### 3.4 Controls Library

**Purpose:** Firm-wide library of formal controls, tested on a schedule, with full testing history,
attestation trail, trend analysis, and quarterly narratives.

**Control record contains:**
- Reference (controlRef, e.g. FP-C001, UW-C001)
- Name, description
- Business area (10 areas: Website & App, Underwriting, Customer Service, Collections, Finance, IT, HR, Marketing, Compliance, Financial Promotions)
- Control owner (User)
- Consumer Duty outcome type
- Control frequency: Daily / Weekly / Monthly / Quarterly / Bi-Annual / Annual / Event-Driven
- Internal or Third Party
- Control type: Preventative / Detective / Corrective / Directive
- Active/inactive flag, standing comments
- `isWatched` flag — CCRO can star/watch priority controls; watched controls highlighted on dashboard

**Testing Schedule (one per control):**
- Testing frequency: Monthly / Quarterly / Bi-Annual / Annual
- Assigned tester (User)
- Summary of test method
- Active flag

**Test Results (one per period per control):**
- Period year and month
- Result: Pass / Fail / Partially / Not Tested / Not Due
- Tester, evidence links, notes
- Backdated flag
- `TestResultRecordModal` — structured card-based test recording UX

**Quarterly Summaries:** 4 zones — Overview (arc gauge + stat tiles + trend chart) ·
Untested Controls (collapsible) · Overall Narrative · Per-Control Summaries (collapsible)

**Attestations:** Monthly attestation from control owner (attested: yes/no, issues flagged).
CCRO can review and agree/disagree with each attestation on the dashboard.

**Operating Effectiveness Badge:** Derived from recent test results — displayed in detail view and modal.

**Trend graph:** 12-month pass-rate area chart per control, viewable in Enter Results tab.

**Change proposals:** Any user can propose a change to a control field; CCRO reviews.

**Links:** Controls link to regulations, policies, processes, and risks.

**CRUD:** CCRO Team can create, edit, archive. Owners can attest and propose changes.
**Import:** CSV upload.
**Export:** CSV + HTML with test history by period.

---

### 3.5 Consumer Duty

**Purpose:** Track compliance with FCA Consumer Duty (PRIN 12 / PRIN 2A) across 5 outcomes,
with monthly MI metrics, RAG status, and 12-month trend history.

**Structure:**
- 5 Outcomes (configurable): Products & Services, Consumer Understanding, Consumer Support, Price & Value, Governance Culture & Oversight
- Each Outcome: 3–10 Measures (24 total)
- Each Measure: 2–5 MI Metrics (18 total)
- Each MI Metric: Monthly snapshot value, RAG status, appetite target, narrative (216 snapshots)

**Outcome record:** Name, short description, detailed description, RAG status (Good/Warning/Red),
risk owner, previous RAG, mitigating actions, monthly summary

**Measure record:** Name, owner (User), summary, RAG status, position (display order)

**MI metric record:** Metric name, current value, previous value, change, RAG status,
appetite (target value), appetite operator (≤ or ≥), narrative

**MetricSnapshot:** Monthly value + RAG for each metric — renders 12-month trend sparkline

**Dashboard widget:** Rolling ticker cycling Outcomes → Measures → Green → Amber → Red.
Fades smoothly, hover-pauses, dot pager, click-through to /consumer-duty.

**CCRO Manage tab:** Direct editing of outcomes, measures, and MI metrics with explicit saves.

**CD measures assigned to Owners** — responsible for monthly updates. CCRO reviews and edits all.

**Linking:** CD MI records link to Actions and Risk Acceptances.

**Annual board attestation:** Process PROC-020 governs the annual Consumer Duty board attestation.

**Import:** CSV wizard for bulk measure/metric updates.
**Export:** CSV + HTML with RAG status and outcome grid.

---

### 3.6 Compliance Universe

**Purpose:** 328-regulation hierarchy of all FCA/PRA/UK GDPR/AML obligations applicable to Updraft.

**Regulation record:** Reference (FCA handbook notation), name, short name, body, type, description,
parent (4-level hierarchy), level, regulatory body, applicability, isApplicable, primary SMF,
secondary SMF, compliance status, assessment notes, last assessed date, next review date

**Hierarchy:** PRIN → PRIN 1, PRIN 2, … → PRIN 2A → PRIN 2A.1, 2A.2, 2A.3, etc.

**Filters:** By body, type, applicability, compliance status, SMF, text search — all URL-synced.

**Links:** Regulations link to controls and policies.

**Access:** Main Compliance page view. Policies accessible via Compliance → Policies tab.

**Export:** CSV by regulatory body / applicability filter.

---

### 3.7 Policy Register

**Purpose:** Library of 21 internal policies with version history, owner accountability,
and links to regulations and controls.

**Policy record:** Reference (POL-001 etc), name, description, owner, status (Draft/Active/Under Review/Archived),
next review date, version, effective date

**Links:** Each policy links to multiple regulations (`PolicyRegulatoryLink`) and controls (`PolicyControlLink`)

**Obligations:** Sub-requirements within a policy tracked for implementation

**Audit log:** Full history of changes

**Access:** Compliance page → Policies tab

**Export:** CSV + HTML with obligation breakdown.

---

### 3.8 SM&CR

**Purpose:** Track Senior Managers and Certification Regime obligations.

**SMF Roles:** 8 SMF roles defined (SMF1/3/9/16/17/24/27/29). Current holders, status, scope, key duties, appointment date.

**Prescribed Responsibilities:** Standard FCA PR-letter mapping to SMF holders.

**Certified Persons:** Annual fitness and propriety certification with breach tracking.

**Conduct Rules:** Individual conduct rule record for each in-scope person.
Breach status: ACTIVE / RESOLVED / UNDER_INVESTIGATION / CLOSED.

**SMCR Documents:** Responsibilities map, individual accountability statements.

**Access Requests:** Users can request temporary elevated access; CCRO approves/denies.

**Export:** SMCR register CSV; certified persons list.

---

### 3.9 Horizon Scanning

**Purpose:** Track upcoming regulatory and market developments, assess impact, generate actions.

**Horizon item record:** Reference (HZ-001 etc), title, category (Regulation/Legislation/Guidance/Market/Technology/Geopolitical),
source, urgency (LOW/MEDIUM/HIGH/CRITICAL), status (MONITORING/ASSESSING/RESPONDING/CLOSED),
summary, why it matters, deadline, source URL, month added, inFocus flag

**Internal CCRO notes field:** Visible to CCRO Team only — stripped at API layer for other roles.

**Generated actions:** Each item can spawn tracked actions (`HorizonActionLink`)

**Risk links:** Items link to existing risks (`HorizonRiskLink`)

**Filters:** Category, urgency, status, dismissed, text search — all URL-synced.

**Export:** CSV with status filter.

---

### 3.10 Operational Resilience

**Purpose:** Map and test resilience of Important Business Services (IBS) against FCA PS21/3.

**IBS:** Each service has impact tolerances, current status, description.

**Resilience Scenarios:** Type (People/Technology/Facilities/Third-Party/Cyber/Natural Disaster/Other),
score (0–100), outcome (GREEN/AMBER/RED/UNTESTED), status.

**Self-Assessments:** Annual board self-assessment per IBS with scenario walkthrough status.

**Process links:** IBS records link to Process Library entries.

**Export:** CSV with IBS and scenario data.

---

### 3.11 Process Library

**Purpose:** Document 20 critical business processes with RACI, controls linkage, and OR mapping.

**Process record:** Reference (PROC-001 etc), name, category, type (Core/Support/Management/Governance),
criticality (Standard/Important/Critical), maturity (1–5), owner, description, purpose,
next review date, frequency, SMF function, prescribed responsibilities, end-to-end SLA

**Steps:** Ordered list of process steps with RACI assignments.

**Links:** Processes link to risks, controls, policies, regulations, IBS.

**Export:** CSV.

---

### 3.12 Regulatory Calendar

**Purpose:** Track regulatory deadlines, events, and milestones.

**RegCalEvent:** Title, date, type, source, linked regulation, linked horizon item, description.

**Notifications:** Deadline events surface in the notification centre.

**Export:** Events CSV by date range.

---

### 3.13 Risk Acceptances

**Purpose:** Formal workflow for accepting residual risks above appetite.

**Status workflow:** Proposed → CCRO Review → Awaiting Approval → Approved / Rejected / Returned → Expired

**Routing:** Proposer submits → CCRO reviews → routes to named approver (CEO or SMF holder)

**Linked items:** Linked risk, linked CD outcome, linked actions

**Approval conditions, review date trigger for expiry**

**Full status transition history with actor, timestamp, details**

**Comment thread from all parties**

**Export:** CSV with status filter + HTML with approval history.

---

### 3.14 Reporting

**Purpose:** Template-based report builder for board packs, management reports.

**Reports:** Title, description, period, status. Sections with text blocks and component embeds.

**Templates:** Reusable report layout templates.

**Components:** Reusable HTML/CSS component library embeddable in reports.

**Versioning:** Each published report snapshotted as JSON.

**Export:** HTML export of published report.

---

### 3.15 Export Centre

**Purpose:** One-click export of any module to CSV or styled HTML packs.

**14 sections:**
1. Risk Register (+ optional per-risk deep-dive spotlight)
2. Controls Library (+ test history)
3. Control Test Results (period filter)
4. Consumer Duty outcomes and metrics
5. Compliance Universe (body/applicability filter)
6. Policies (status filter)
7. Actions (+ optional action spotlight pages)
8. Risk Acceptances (status filter)
9. Horizon Scanning (status filter)
10. SMCR register (role type filter)
11. Processes & IBS
12. SMCR Documents
13. Regulatory Calendar
14. Programme summary / KPI page

**HTML packs:** Table of contents with anchor links. Styled for direct Board/FCA presentation.

**Every export event logged to Audit Log.**

---

### 3.16 Audit Trail

**Purpose:** Immutable log of all changes across the system.

**Requirements:**
- Every create/update/delete logged with: user, role, entity type, entity ID, field changes (JSON diff), timestamp
- Full searchable log in the Audit page (CCRO Team only)
- No edit or delete on audit entries — append only
- Export: full audit log CSV by date range / entity type

---

### 3.17 User Management & Access Control

**Purpose:** Manage user accounts, roles, permissions, and access requests.

**Requirements:**
- 4 roles: CCRO_TEAM, CEO, OWNER, REVIEWER
- Role-based permissions matrix (`src/lib/permissions.ts`)
- User-level permission overrides
- Access request workflow: user requests → CCRO approves with time limit → auto-expiry
- Google OAuth sign-in with DB allowlist
- Dashboard layout preferences persisted per user

---

### 3.18 Dark Mode

**Purpose:** Full dark mode support for all screens and components.

**Requirements:**
- `next-themes` with `attribute="class"`, `defaultTheme="system"`, `enableSystem`
- System preference respected on first load; preference persisted to localStorage
- `.dark` CSS block in `globals.css` — sections A (CSS variables), B (Tailwind utility remapping), C (component-specific overrides)
- Toggle button in sidebar (sun/moon icon) — works in both collapsed and expanded sidebar
- 263+ components adapt automatically via Tailwind utility class remapping
- Text contrast ~14.5:1 in dark mode; RAG colours visible (not overridden)

---

## 4. Technical Architecture

| Layer | Technology |
|---|---|
| Frontend | Next.js 14 App Router, React 18, TypeScript, Tailwind CSS |
| State | Zustand (optimistic local + API sync via explicit saves) |
| Animation | Framer Motion v12 (spring physics, stagger, page transitions) |
| Charts | Recharts v3.7 (Area, Radar, Bar, Line) |
| Layout | react-grid-layout (2D drag/resize dashboard) |
| Database | Supabase PostgreSQL (hosted), Prisma 7 ORM + @prisma/adapter-pg |
| Hosting | Vercel (Next.js + API routes, auto-deploy from GitHub) |
| Auth | NextAuth v5 / Auth.js with Google OAuth, JWT sessions, DB allowlist |
| Theme | next-themes (dark/light/system) |

---

## 5. Key Design Principles

1. **All data persists** — Every user interaction that changes data must call the API and persist to the DB.
   Zustand store is a cache, not the source of truth. Explicit save with toast confirmation — no silent background sync.

2. **Every count is a filter** — Every summary stat card ("5 HIGH risks") filters the view below when clicked.
   Read-only stat cards are not permitted.

3. **All elements are editable** — The CCRO Team can edit every field on every screen.
   Owner-role edits follow assigned permissions.

4. **UK regulatory context** — All domain language uses UK FCA terminology. Spelling is British English throughout.

5. **Role-appropriate views** — Dashboard sections, navigation items, and edit capabilities are gated by role.

6. **Graceful degradation** — If the API is unreachable, the app shows the last-known store data.

7. **Edit-unlock pattern** — Panels open in read-only mode with a Pencil button; clicking unlocks editing.
   Pencil/Cancel/Save in header. AutoResizeTextarea for all multi-line fields.

8. **URL state sync** — All filter and tab state syncs to URL params for deep-linking and browser navigation.

9. **Dark mode first** — All new components must work in both light and dark mode.

---

## 6. Data Model Summary

| Entity | Count (seeded) | Notes |
|---|---|---|
| Users | 8 | Fixed team |
| Risks | 15 | With 180 monthly snapshots |
| Risk categories | 5 L1, 18 L2 | Seeded |
| Actions | 45 | P1/P2/P3, all statuses |
| Controls | 30+ | 18 FP + 12+ other business areas |
| Control test results | 12-month history per control | |
| CD Outcomes | 5 | With measures, MI, snapshots |
| CD Measures | 24 | Assigned to Owners |
| CD MI Metrics | 18 | With 216 monthly snapshots |
| Regulations | 328 | Full FCA/PRA/ICO universe |
| Policies | 21 | With regulation + control links |
| SMF Roles | 8 | SMF1/3/9/16/17/24/27/29 |
| Processes | 20 | RACI documented |
| Horizon Items | 8+ | Monthly scan |
| IBS | 4 | With scenarios |
| Risk Acceptances | 6 | Various statuses |
| Risk Mitigations | 45 | 3 per risk |

---

## 7. API Route Map

| Module | Route prefix | Verbs implemented |
|---|---|---|
| Risks | `/api/risks` | GET, POST, PATCH, DELETE |
| Actions | `/api/actions` | GET, POST, PATCH, DELETE |
| Controls | `/api/controls` | GET, POST, PATCH |
| Consumer Duty | `/api/consumer-duty` | GET, POST, PATCH, DELETE |
| Compliance | `/api/compliance` | GET, POST, PATCH |
| Regulations | `/api/regulations` | GET, POST, PATCH |
| Policies | `/api/policies` | GET, POST, PATCH |
| Horizon Items | `/api/horizon-items` | GET, POST, PATCH, DELETE |
| Processes | `/api/processes` | GET, POST, PATCH |
| IBS / OR | `/api/ibs` | GET, POST, PATCH |
| Risk Acceptances | `/api/risk-acceptances` | GET, POST, PATCH |
| Reports | `/api/reports` | GET, POST, PATCH |
| Export | `/api/export` | POST |
| Audit | `/api/audit` | GET |
| Users | `/api/users` | GET, POST, PATCH |
| Dashboard Layout | `/api/dashboard-layout` | GET, POST, PATCH |
| Access Requests | `/api/access-requests` | GET, POST, PATCH |
| Notifications | `/api/notifications` | GET, POST, PATCH |
| Settings | `/api/settings` | GET, POST, PATCH |
| Health | `/api/health` | GET |

---

*Document generated from: src/app/, src/components/, src/lib/, prisma/schema.prisma*
*Version 2.0 — updated February 2026 to reflect 26-sprint build state*
